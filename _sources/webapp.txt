=================
Web アプリ 導入編
=================
Django で Web アプリを作成します。

プロジェクトの作成と設定
========================
:command:`virtualenv` を使って専用環境を作成します。 ::

    > D:
    > cd D:\sandbox
    > C:\Python27\Scripts\virtualenv.exe --distribute django-sample

`django-sample` フォルダに :file:`requirements.txt` を作成し、 :command:`pip` で読み込ませます。 ::

    > cd django-sample
    > notepad requirements.txt        # 下記参照
    > Scripts\activate
    > pip install -r requirements.txt

.. note::

    :file:`requirements.txt` ::

        Django==1.3

:file:`django-admin.py` というスクリプトが追加されます。
これを使ってカテゴリーテンプレートを管理するプロジェクト `cateditor` を作成します。 ::

    > python Scripts\django-admin.py startproject cateditor

cateditor の :file:`settings.py` を編集します。 ::

    > cd cateditor
    > notepad settings.py        # 下記参照

.. note::
    データベースには SQLite を使いますので、 DATABASES の部分を次のように変更します。 ::

        DATABASES = {
            'default': {
                'ENGINE': 'django.db.backends.sqlite3',
                'NAME': 'cateditor.sqlite',
                'USER': '',
                'PASSWORD': '',
                'HOST': '',
                'PORT': '',
            }
        }

Django の管理ツール :file:`manage.py` を使ってデータベースを作成します。 ::

    > python manage.py syncdb

次の質問には "yes" と答え、ユーザー名、メールアドレス、パスワードをそれぞれ入力します。

    Would you like to create one now? (yes/no): yes

フォルダには先ほど指定したデータベースファイル :file:`cateditor.sqlite` が作成されています。 ::

    > dir /b
    cateditor.sqlite
    manage.py
    settings.py
    settings.pyc
    urls.py
    __init__.py
    __init__.pyc

.. note::

    カテゴリーテンプレートとは？

    海外LBSに必要なものです。管理が大変なので、管理用アプリケーションを誰か作ってください m(_ _)m

管理画面の有効化
================
Django には管理画面がアプリケーションとして同梱されていますので、それを有効化します。
:file:`settings.py` と :file:`urls.py` を編集します。

:file:`settings.py` の下の方にある INSTALLED_APPS で ``django.contrib.admin``  をコメントインします。 ::

    INSTALLED_APPS = (
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.sites',
        'django.contrib.messages',
        'django.contrib.staticfiles',
        # Uncomment the next line to enable the admin:
        'django.contrib.admin',
        # Uncomment the next line to enable admin documentation:
        # 'django.contrib.admindocs',
    )

:file:`urls.py` を変更します。英語ですが、コメントを読んでください。 ::

    from django.conf.urls.defaults import patterns, include, url

    # Uncomment the next two lines to enable the admin:
    from django.contrib import admin
    admin.autodiscover()

    urlpatterns = patterns('',
        # Examples:
        # url(r'^$', 'cateditor.views.home', name='home'),
        # url(r'^cateditor/', include('cateditor.foo.urls')),

        # Uncomment the admin/doc line below to enable admin documentation:
        # url(r'^admin/doc/', include('django.contrib.admindocs.urls')),

        # Uncomment the next line to enable the admin:
        url(r'^admin/', include(admin.site.urls)),
    )

テストサーバの起動
==================
Django の管理ツール :file:`manage.py` を使ってテストサーバを起動します。 ::

    > python manage.py runserver

Web ブラウザで 8000 番ポートの `/admin` にアクセスすると管理画面が表示されます。

* http://localhost:8000/admin/

ユーザー名とパスワードは、上述の syncdb のときに入力したものです。

Ctrl+C でテストサーバを停止できます。

次は？
======
Django には豊富なドキュメントが用意されています。
チュートリアルを読みながら一通り手を動かしてみてください。

* `Django チュートリアル`_
* `Django チュートリアル 日本語`_ (バージョン 1.0 なのでちょっと古い)

.. _Django チュートリアル: https://docs.djangoproject.com/en/dev/intro/tutorial01/
.. _Django チュートリアル 日本語: http://djangoproject.jp/doc/ja/1.0/

* `Open sourcing your Django site`_

.. _Open sourcing your Django site: http://blog.mozilla.com/webdev/2011/10/20/open-sourcing-your-django-site/

アプリケーションの作成
======================
アプリケーションを作成します。 ::

    > python manage.py startapp cateditor

Django においてプロジェクトとアプリケーションを異なります。
詳しくは公式ドキュメントを参照してください。

アプリケーションは :file:`settings.py` に登録します。

モデルの定義
------------
アプリケーションの :file:`models.py` を編集します。

変更が終わったら syncdb を実行し、管理画面を確認しましょう。


* `Pinax`_
* `GeoDjango`_

.. _Pinax: http://pinaxproject.com/
.. _GeoDjango: https://github.com/dotcloud/geodjango-on-dotcloud
